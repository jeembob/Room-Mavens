<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloomhaven Card Browser</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #eee;
            margin: 0;
            padding: 8px 20px;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 8px;
        }
        h1 {
            color: #c9a227;
            margin: 0;
            font-size: 20px;
        }
        select {
            padding: 4px 10px;
            font-size: 14px;
            background: #333;
            color: #eee;
            border: 1px solid #c9a227;
            border-radius: 4px;
        }
        .tab-btn {
            padding: 4px 14px;
            font-size: 14px;
            background: #333;
            color: #eee;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn:hover {
            background: #444;
        }
        .tab-btn.active {
            background: #c9a227;
            color: #1a1a2e;
            border-color: #c9a227;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .cell {
            aspect-ratio: 2/3;
            background: #2a2a4a;
            border: 2px dashed #444;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100px;
        }
        .cell.drag-over {
            border-color: #c9a227;
            background: #3a3a5a;
        }
        .card {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
            cursor: grab;
            transition: transform 0.2s, z-index 0s;
        }
        .card:hover {
            transform: scale(2);
            z-index: 100;
            position: relative;
        }
        .card:active {
            cursor: grabbing;
        }
        .card.dragging {
            opacity: 0.5;
        }
        .card-pool {
            max-width: 1200px;
            margin: 8px auto 0;
            padding: 10px;
            background: #2a2a4a;
            border-radius: 8px;
        }
        .card-pool h2 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #c9a227;
        }
        .pool-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
        }
        .pool-card {
            aspect-ratio: 2/3;
            width: 100%;
            cursor: grab;
            border-radius: 6px;
            transition: transform 0.2s;
        }
        .pool-card:hover {
            transform: scale(2);
            z-index: 100;
            position: relative;
        }
        .pool-card.dragging {
            opacity: 0.5;
        }
        /* Card Selector Tab */
        .selector-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 12px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .selector-item {
            position: relative;
            aspect-ratio: 2/3;
        }
        .selector-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
            border: 3px solid transparent;
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
        }
        .selector-item:hover img {
            transform: scale(2);
            z-index: 100;
            position: relative;
        }
        .selector-item input {
            display: none;
        }
        .selector-item input:checked + img {
            border-color: #c9a227;
            box-shadow: 0 0 15px rgba(201, 162, 39, 0.5);
        }
        .selector-item label {
            cursor: pointer;
            display: block;
            width: 100%;
            height: 100%;
        }
        .selector-item .checkmark {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .selector-item input:checked ~ .checkmark {
            opacity: 1;
            background: #c9a227;
        }
        .checkmark::after {
            content: 'âœ“';
            color: #1a1a2e;
            font-weight: bold;
        }
        .empty-pool {
            grid-column: 1 / -1;
            text-align: center;
            color: #666;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Gloomhaven</h1>
        <select id="character">
            <option value="Bruiser">Bruiser</option>
        </select>
        <button class="tab-btn active" data-tab="play">Play</button>
        <button class="tab-btn" data-tab="select">Select Cards</button>
    </div>

    <div id="play" class="tab-content active">
        <div class="grid" id="grid"></div>

        <div class="card-pool">
            <h2>Selected Cards</h2>
            <div class="pool-grid" id="pool"></div>
        </div>
    </div>

    <div id="select" class="tab-content">
        <div class="selector-grid" id="selector"></div>
    </div>

    <script>
        const ROWS = 3;
        const COLS = 8;
        
        // Card data: sorted by level, then initiative
        const cardData = {
            Bruiser: [
                { file: "balanced-measure.jpeg", level: 1, initiative: 20 },
                { file: "eye-for-an-eye.jpeg", level: 1, initiative: 13 },
                { file: "shield-bash.jpeg", level: 1, initiative: 15 },
                { file: "spare-dagger.jpeg", level: 1, initiative: 27 },
                { file: "warding-strength.jpeg", level: 1, initiative: 32 },
                { file: "skewer.jpeg", level: 1, initiative: 35 },
                { file: "leaping-cleave.jpeg", level: 1, initiative: 54 },
                { file: "overwhelming-assault.jpeg", level: 1, initiative: 61 },
                { file: "trample.jpeg", level: 1, initiative: 72 },
                { file: "grab-and-go.jpeg", level: 1, initiative: 87 },
                { file: "juggernaut.jpeg", level: 2, initiative: 34 },
                { file: "intimidating-growl.jpeg", level: 2, initiative: 51 },
                { file: "hook-and-chain.jpeg", level: 3, initiative: 42 },
                { file: "unstoppable-charge.jpeg", level: 3, initiative: 86 },
                { file: "whirlwind.jpeg", level: 4, initiative: 28 },
                { file: "push-through.jpeg", level: 4, initiative: 57 },
                { file: "skirmishing-maneuver.jpeg", level: 5, initiative: 29 },
                { file: "defensive-tactics.jpeg", level: 5, initiative: 39 },
                { file: "immovable-phalanx.jpeg", level: 6, initiative: 17 },
                { file: "run-through.jpeg", level: 6, initiative: 33 },
                { file: "selfish-retribution.jpeg", level: 7, initiative: 8 },
                { file: "leg-fly.jpeg", level: 7, initiative: 19 },
                { file: "fearsome-taunt.jpeg", level: 8, initiative: 10 },
                { file: "crippling-offensive.jpeg", level: 8, initiative: 16 },
                { file: "provoking-roar.jpeg", level: 8, initiative: 18 },
                { file: "sweeping-blow.jpeg", level: 8, initiative: 23 },
                { file: "frenzied-onslaught.jpeg", level: 8, initiative: 41 },
                { file: "brute-force.jpeg", level: 9, initiative: 9 },
                { file: "face-your-end.jpeg", level: 9, initiative: 67 }
            ]
        };
        
        // Extract just filenames for compatibility
        const cards = {
            Bruiser: cardData.Bruiser.map(c => c.file)
        };

        let selectedCards = new Set();
        let draggedCard = null;
        let dragSource = null;

        function init() {
            createGrid();
            loadSelector();
            setupTabs();
            document.getElementById('character').addEventListener('change', () => {
                selectedCards.clear();
                clearGrid();
                loadSelector();
                updatePool();
            });
        }

        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(btn.dataset.tab).classList.add('active');
                });
            });
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for (let i = 0; i < ROWS * COLS; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.addEventListener('dragover', handleDragOver);
                cell.addEventListener('dragleave', handleDragLeave);
                cell.addEventListener('drop', handleDrop);
                grid.appendChild(cell);
            }
        }

        function clearGrid() {
            document.querySelectorAll('.cell').forEach(cell => cell.innerHTML = '');
        }

        function loadSelector() {
            const character = document.getElementById('character').value;
            const selector = document.getElementById('selector');
            selector.innerHTML = '';

            cards[character].forEach(card => {
                const item = document.createElement('div');
                item.className = 'selector-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `check-${card}`;
                checkbox.dataset.card = card;
                checkbox.checked = selectedCards.has(card);
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        selectedCards.add(card);
                    } else {
                        selectedCards.delete(card);
                        // Remove from grid if present
                        removeCardFromGrid(card);
                    }
                    updatePool();
                });

                const label = document.createElement('label');
                label.htmlFor = `check-${card}`;
                
                const img = document.createElement('img');
                img.src = `images/${character}/${card}`;
                
                const checkmark = document.createElement('div');
                checkmark.className = 'checkmark';

                label.appendChild(checkbox);
                label.appendChild(img);
                item.appendChild(label);
                item.appendChild(checkmark);
                selector.appendChild(item);
            });
        }

        function removeCardFromGrid(card) {
            const gridCard = document.querySelector(`.cell .card[data-card="${card}"]`);
            if (gridCard) {
                gridCard.parentElement.innerHTML = '';
            }
        }

        function updatePool() {
            const character = document.getElementById('character').value;
            const pool = document.getElementById('pool');
            pool.innerHTML = '';

            // Get cards that are in the grid
            const cardsInGrid = new Set();
            document.querySelectorAll('.cell .card').forEach(card => {
                cardsInGrid.add(card.dataset.card);
            });

            // Show only selected cards not in grid
            const availableCards = [...selectedCards].filter(card => !cardsInGrid.has(card));
            
            if (availableCards.length === 0 && selectedCards.size === 0) {
                pool.innerHTML = '<div class="empty-pool">No cards selected. Go to Card Selector to choose cards.</div>';
                return;
            }

            availableCards.forEach(card => {
                const img = document.createElement('img');
                img.src = `images/${character}/${card}`;
                img.className = 'pool-card';
                img.draggable = true;
                img.dataset.card = card;
                img.addEventListener('dragstart', handlePoolDragStart);
                img.addEventListener('dragend', handleDragEnd);
                pool.appendChild(img);
            });
        }

        function handlePoolDragStart(e) {
            draggedCard = e.target.dataset.card;
            dragSource = 'pool';
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleGridDragStart(e) {
            draggedCard = e.target.dataset.card;
            dragSource = e.target.parentElement;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const cell = e.currentTarget;
            cell.classList.remove('drag-over');

            if (!draggedCard) return;

            const character = document.getElementById('character').value;
            const existingCard = cell.querySelector('.card');

            if (dragSource === 'pool') {
                if (existingCard) {
                    existingCard.remove();
                }
                addToCell(cell, draggedCard, character);
            } 
            else if (dragSource instanceof Element) {
                const sourceCard = dragSource.querySelector('.card');
                
                if (existingCard) {
                    dragSource.innerHTML = '';
                    addToCell(dragSource, existingCard.dataset.card, character);
                } else {
                    dragSource.innerHTML = '';
                }
                
                cell.innerHTML = '';
                addToCell(cell, draggedCard, character);
            }

            draggedCard = null;
            dragSource = null;
            updatePool();
        }

        function addToCell(cell, card, character) {
            const img = document.createElement('img');
            img.src = `images/${character}/${card}`;
            img.className = 'card';
            img.draggable = true;
            img.dataset.card = card;
            img.addEventListener('dragstart', handleGridDragStart);
            img.addEventListener('dragend', handleDragEnd);
            cell.appendChild(img);
        }

        init();
    </script>
</body>
</html>
